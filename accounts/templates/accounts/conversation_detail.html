{% extends "films/base.html" %}
{% block content %}
<div class="container py-4">
    <h1>–°–æ–æ–±—â–µ–Ω–∏—è</h1>

    <!-- –°–ø–∏—Å–æ–∫ —Å–æ–æ–±—â–µ–Ω–∏–π -->
    <div class="card mb-4" style="max-height: 500px; overflow-y: auto;">
        {% for msg in messages %}
            <div class="p-3 {% if msg.sender == request.user %}bg-light text-end{% endif %}">
                <small class="text-muted">{{ msg.sender.username }}</small>
                
                {% if msg.content %}
                    <div>{{ msg.content }}</div>  <!-- ‚Üê —É–±—Ä–∞–Ω |linebreaks, —Ç.–∫. markdown —Å–∞–º —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç -->
                {% endif %}
                
                {% if msg.files.exists %}
                    <div class="mt-2">
                        <strong>–§–∞–π–ª—ã:</strong>
                        <ul class="list-unstyled mb-0">
                            {% for file in msg.files.all %}
                                <li>
                                    {% if file.file.url|slice:"-4:" in ".jpg.png.gif.jpeg" %}
                                        <img src="{{ file.file.url }}" class="img-thumbnail me-2" style="max-height: 80px;">
                                    {% else %}
                                        <a href="{{ file.file.url }}" class="me-2">
                                            üìé {{ file.file.name }}
                                        </a>
                                    {% endif %}
                                </li>
                            {% endfor %}
                        </ul>
                    </div>
                {% endif %}
                
                <small class="text-muted">{{ msg.created_at|date:"d.m.Y H:i" }}</small>
            </div>
        {% empty %}
            <div class="p-3">–ù–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–π.</div>
        {% endfor %}
    </div>

    <!-- –§–æ—Ä–º–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ (–≤–Ω–µ —Ü–∏–∫–ª–∞!) -->
    <form method="post" enctype="multipart/form-data">
        {% csrf_token %}
        <div class="mb-2">
            <textarea name="content" class="form-control" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ" rows="2"></textarea>
        </div>
        <div class="mb-2">
            <label for="files">–ü—Ä–∏–∫—Ä–µ–ø–∏—Ç—å —Ñ–∞–π–ª—ã:</label>
            <input type="file" name="files" multiple class="form-control">
        </div>
        <button type="submit" class="btn btn-primary">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
        <a href="{% url 'accounts:conversation_list' %}" class="btn btn-secondary">–ù–∞–∑–∞–¥</a>
    </form>
</div>
{% endblock %}